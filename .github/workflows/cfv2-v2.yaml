name: cfv2-v2
on:
  workflow_dispatch:
#  schedule:
#    - cron: 30 22 * * *
#    - cron: 40 4 * * *
#    - cron: 50 10 * * *

jobs:
  env:
    runs-on: ubuntu-latest
    steps:
      - name: Set ENV
        run: |
          sudo apt update
          sudo apt -y install sshpass
          sudo passwd runner << EOD
          root
          root
          EOD
      - name: Set v2ray
        run: |
          mkdir v2ray
          cd v2ray
          wget https://github.com/v2fly/v2ray-core/releases/download/v5.0.6/v2ray-linux-64.zip
          unzip v2ray-linux-64.zip
          base64 -d > config.json << EOD
          ewoJImxvZyI6IHsKCQkibG9nbGV2ZWwiOiAiaW5mbyIKCX0sCgkiaW5ib3VuZHMiOiBbCgkJewoJ
          CQkicG9ydCI6IDM0NTYsCgkJCSJwcm90b2NvbCI6ICJ2bWVzcyIsCgkJCSJhbGxvY2F0ZSI6IHsK
          CQkJCSJzdHJhdGVneSI6ICJhbHdheXMiCgkJCX0sCgkJCSJzZXR0aW5ncyI6IHsKCQkJCSJjbGll
          bnRzIjogWwoJCQkJCXsKCQkJCQkJImlkIjogIjI2ZTNhNjIwLWUzM2UtNDVlNi1iMzE2LTQ1NzBi
          MGVjZjM5YyIsCgkJCQkJCSJsZXZlbCI6IDEsCgkJCQkJCSJhbHRlcklkIjogMCwKCQkJCQkJImVt
          YWlsIjogImNsaWVudEBleGFtcGxlLmNvbSIKCQkJCQl9CgkJCQldLAoJCQkJImRpc2FibGVJbnNl
          Y3VyZUVuY3J5cHRpb24iOiB0cnVlCgkJCX0sCgkJCSJzdHJlYW1TZXR0aW5ncyI6IHsKCQkJCSJu
          ZXR3b3JrIjogIndzIiwKCQkJCSJ3c1NldHRpbmdzIjogewoJCQkJCSJjb25uZWN0aW9uUmV1c2Ui
          OiB0cnVlLAoJCQkJCSJwYXRoIjogIi9ncmFwaHFsIgoJCQkJfSwKCQkJCSJzZWN1cml0eSI6ICJu
          b25lIiwKCQkJCSJ0Y3BTZXR0aW5ncyI6IHsKCQkJCQkiaGVhZGVyIjogewoJCQkJCQkidHlwZSI6
          ICJodHRwIiwKCQkJCQkJInJlc3BvbnNlIjogewoJCQkJCQkJInZlcnNpb24iOiAiMS4xIiwKCQkJ
          CQkJCSJzdGF0dXMiOiAiMjAwIiwKCQkJCQkJCSJyZWFzb24iOiAiT0siLAoJCQkJCQkJImhlYWRl
          cnMiOiB7CgkJCQkJCQkJIkNvbnRlbnQtVHlwZSI6IFsKCQkJCQkJCQkJImFwcGxpY2F0aW9uL29j
          dGV0LXN0cmVhbSIsCgkJCQkJCQkJCSJhcHBsaWNhdGlvbi94LW1zZG93bmxvYWQiLAoJCQkJCQkJ
          CQkidGV4dC9odG1sIiwKCQkJCQkJCQkJImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoIgoJ
          CQkJCQkJCV0sCgkJCQkJCQkJIlRyYW5zZmVyLUVuY29kaW5nIjogWwoJCQkJCQkJCQkiY2h1bmtl
          ZCIKCQkJCQkJCQldLAoJCQkJCQkJCSJDb25uZWN0aW9uIjogWwoJCQkJCQkJCQkia2VlcC1hbGl2
          ZSIKCQkJCQkJCQldLAoJCQkJCQkJCSJQcmFnbWEiOiAibm8tY2FjaGUiCgkJCQkJCQl9CgkJCQkJ
          CX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgldLAoJIm91dGJvdW5kcyI6IFsKCQl7CgkJCSJwcm90
          b2NvbCI6ICJmcmVlZG9tIiwKCQkJInNldHRpbmdzIjoge30KCQl9LAoJCXsKCQkJInByb3RvY29s
          IjogImJsYWNraG9sZSIsCgkJCSJzZXR0aW5ncyI6IHt9LAoJCQkidGFnIjogImJsb2NrZWQiCgkJ
          fQoJXSwKCSJyb3V0aW5nIjogewoJCSJkb21haW5TdHJhdGVneSI6ICJBc0lzIiwKCQkicnVsZXMi
          OiBbCgkJCXsKCQkJCSJ0eXBlIjogImZpZWxkIiwKCQkJCSJpcCI6IFsKCQkJCQkiMC4wLjAuMC84
          IiwKCQkJCQkiMTAuMC4wLjAvOCIsCgkJCQkJIjEwMC42NC4wLjAvMTAiLAoJCQkJCSIxMjcuMC4w
          LjAvOCIsCgkJCQkJIjE2OS4yNTQuMC4wLzE2IiwKCQkJCQkiMTcyLjE2LjAuMC8xMiIsCgkJCQkJ
          IjE5Mi4wLjAuMC8yNCIsCgkJCQkJIjE5Mi4wLjIuMC8yNCIsCgkJCQkJIjE5Mi4xNjguMC4wLzE2
          IiwKCQkJCQkiMTk4LjE4LjAuMC8xNSIsCgkJCQkJIjE5OC41MS4xMDAuMC8yNCIsCgkJCQkJIjIw
          My4wLjExMy4wLzI0IiwKCQkJCQkiOjoxLzEyOCIsCgkJCQkJImZjMDA6Oi83IiwKCQkJCQkiZmU4
          MDo6LzEwIiwKCQkJCQkiZ2VvaXA6cHJpdmF0ZSIKCQkJCV0sCgkJCQkib3V0Ym91bmRUYWciOiAi
          YmxvY2tlZCIKCQkJfSwKCQkJewoJCQkJInR5cGUiOiAiZmllbGQiLAoJCQkJInByb3RvY29sIjog
          WwoJCQkJCSJiaXR0b3JyZW50IgoJCQkJXSwKCQkJCSJvdXRib3VuZFRhZyI6ICJibG9ja2VkIgoJ
          CQl9CgkJXQoJfQp9
          EOD
          nohup ./v2ray run > v2ray.log &
          cd ~
      - name: c
        run: |
          sudo wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb && sudo dpkg -i cloudflared-linux-amd64.deb
          sysctl -w net.core.rmem_max=2500000
          cat > config.yaml << EOD
          dHVubmVsOiBkMmIwYWNkZi0zODE0LTQwMjYtOWU5YS1kMjk2YmE4MTZmMWQKY3JlZGVudGlhbHMtZmlsZTogMS5qc29uCmluZ3Jlc3M6CiAgLSBob3N0bmFtZTogdjIuOHA2NjYuZ2EKICAgIHBhdGg6IC9ncmFwaHFsCiAgICBzZXJ2aWNlOiB3czovL2xvY2FsaG9zdDozNDU2CiAgLSBob3N0bmFtZTogdjIuOHA2NjYuZ2EKICAgIHNlcnZpY2U6IGh0dHA6Ly9sb2NhbGhvc3Q6ODAKICAtIHNlcnZpY2U6IGh0dHBfc3RhdHVzOjQwNA==
          EOD
          cat > 1.json << EOD
          eyJBY2NvdW50VGFnIjoiNDg5NDg2M2ZkYTg0ODRiMDk3NGE0YzQ4NjI3NWVhY2QiLCJUdW5uZWxTZWNyZXQiOiJFalFiQzA4R2JDT2Exb3pvQ2IrQWdFRlJ5cFpMdEtFZlp3RXorZUkzK0cwPSIsIlR1bm5lbElEIjoiZDJiMGFjZGYtMzgxNC00MDI2LTllOWEtZDI5NmJhODE2ZjFkIn0=
          EOD
          cat > cert.pem << EOD
          LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JR0hBZ0VBTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEJHMHdhd0lCQVFRZ21PajBMU0EvN3BwK3BtZHcKVUpXalJ1WHpQOTV4MWR0bWpvYm92TEV1d0o2aFJBTkNBQVRiUHNwSGlzaDgzMmlhOFVzeEVCbzB4UUdzWTFueAp6Sk5HNFdFQUVuR0VHVEJEcXNWcm1MRVJHQzJqK3BXeTlocDJOMUhrUW5FZnhUbGpFeVR6ZWVJUwotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlESFRDQ0FzS2dBd0lCQWdJVVhnN3dMbFFrSXVjand3UG8zak96NFV1TzZ6b3dDZ1lJS29aSXpqMEVBd0l3CmdZOHhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSEV3MVQKWVc0Z1JuSmhibU5wYzJOdk1Sa3dGd1lEVlFRS0V4QkRiRzkxWkVac1lYSmxMQ0JKYm1NdU1UZ3dOZ1lEVlFRTApFeTlEYkc5MVpFWnNZWEpsSUU5eWFXZHBiaUJUVTB3Z1JVTkRJRU5sY25ScFptbGpZWFJsSUVGMWRHaHZjbWwwCmVUQWVGdzB5TWpFeU1UWXdOVFV6TURCYUZ3MHpOekV5TVRJd05UVXpNREJhTUdJeEdUQVhCZ05WQkFvVEVFTnMKYjNWa1JteGhjbVVzSUVsdVl5NHhIVEFiQmdOVkJBc1RGRU5zYjNWa1JteGhjbVVnVDNKcFoybHVJRU5CTVNZdwpKQVlEVlFRREV4MURiRzkxWkVac1lYSmxJRTl5YVdkcGJpQkRaWEowYVdacFkyRjBaVEJaTUJNR0J5cUdTTTQ5CkFnRUdDQ3FHU000OUF3RUhBMElBQk5zK3lrZUt5SHpmYUpyeFN6RVFHalRGQWF4aldmSE1rMGJoWVFBU2NZUVoKTUVPcXhXdVlzUkVZTGFQNmxiTDJHblkzVWVSQ2NSL0ZPV01USlBONTRoS2pnZ0VtTUlJQklqQU9CZ05WSFE4QgpBZjhFQkFNQ0JhQXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0lHQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCCi93UUNNQUF3SFFZRFZSME9CQllFRkhDMXJvaWNiS3oyM0E0U2NpTDl1S0dsT0N6bU1COEdBMVVkSXdRWU1CYUEKRklVd1hUc3FjTlR0MVpKbkIvM3JPYlFhRGppbk1FUUdDQ3NHQVFVRkJ3RUJCRGd3TmpBMEJnZ3JCZ0VGQlFjdwpBWVlvYUhSMGNEb3ZMMjlqYzNBdVkyeHZkV1JtYkdGeVpTNWpiMjB2YjNKcFoybHVYMlZqWTE5allUQWZCZ05WCkhSRUVHREFXZ2dvcUxqaHdOalkyTG1kaGdnZzRjRFkyTmk1bllUQThCZ05WSFI4RU5UQXpNREdnTDZBdGhpdG8KZEhSd09pOHZZM0pzTG1Oc2IzVmtabXhoY21VdVkyOXRMMjl5YVdkcGJsOWxZMk5mWTJFdVkzSnNNQW9HQ0NxRwpTTTQ5QkFNQ0Ewa0FNRVlDSVFEK1p1dTFELzhTakxVcHg3c0xQV2dXdEZERGFVSEd5KzdoZFdpN29wb1Uyd0loCkFQVXJzQlJoaENiYThadlVQQ1NqRVp5ZFg4WGs4d3RXMlBzcnFsUjFxcnFnCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBBUkdPIFRVTk5FTCBUT0tFTi0tLS0tCmV5SjZiMjVsU1VRaU9pSTVNVFJrTnpjM01UZzJNalZtWmpZeE1UQXdPREF5WmpGbU16azROV0UzT0NJc0ltRmoKWTI5MWJuUkpSQ0k2SWpRNE9UUTROak5tWkdFNE5EZzBZakE1TnpSaE5HTTBPRFl5TnpWbFlXTmtJaXdpYzJWeQpkbWxqWlV0bGVTSTZJbll4TGpBdFlXWmhPREZrTVRsaU9HWTJPR1k0TWpNeU16SmtNRE0wTFdJNU5UWmlNemsxCllXVmtaalkxT1Rka016WTBaRGxqTTJFNU1USXdZekEzTTJKa09ETTROak5pWlRZNU1USTFPVE13WldabE1qZGsKT1dJMFpqVmpOamRsWlRoaE16YzJabUZtT0RKaE9UWTRObU0zWkRnNE1qWmxaREZoTkRZd09EQXlObUU0WWpCbQpOVGt5WTJNMVpXRmtaall3WkRWak5XVmpNamxsTldKaFpEY3hPVGhpWkRsaFpUSTRNalZqTlRNek1ETmhPRE13ClpqazJPR00xTVRNaUxDSmhjR2xVYjJ0bGJpSTZJakI1UkY5a04wWlFWbFJMUVRJMFRIb3RjSE5pV1dWcWMxbGsKWmt0M1NsaFBObEZmUTFZeWNUUWlmUT09Ci0tLS0tRU5EIEFSR08gVFVOTkVMIFRPS0VOLS0tLS0tLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS0KTUlHSEFnRUFNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQkcwd2F3SUJBUVFnbU9qMExTQS83cHArcG1kdwpVSldqUnVYelA5NXgxZHRtam9ib3ZMRXV3SjZoUkFOQ0FBVGJQc3BIaXNoODMyaWE4VXN4RUJvMHhRR3NZMW54CnpKTkc0V0VBRW5HRUdUQkRxc1ZybUxFUkdDMmorcFd5OWhwMk4xSGtRbkVmeFRsakV5VHplZUlTCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIVENDQXNLZ0F3SUJBZ0lVWGc3d0xsUWtJdWNqd3dQbzNqT3o0VXVPNnpvd0NnWUlLb1pJemowRUF3SXcKZ1k4eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCRGJHOTFaRVpzWVhKbExDQkpibU11TVRnd05nWURWUVFMCkV5OURiRzkxWkVac1lYSmxJRTl5YVdkcGJpQlRVMHdnUlVORElFTmxjblJwWm1sallYUmxJRUYxZEdodmNtbDAKZVRBZUZ3MHlNakV5TVRZd05UVXpNREJhRncwek56RXlNVEl3TlRVek1EQmFNR0l4R1RBWEJnTlZCQW9URUVOcwpiM1ZrUm14aGNtVXNJRWx1WXk0eEhUQWJCZ05WQkFzVEZFTnNiM1ZrUm14aGNtVWdUM0pwWjJsdUlFTkJNU1l3CkpBWURWUVFERXgxRGJHOTFaRVpzWVhKbElFOXlhV2RwYmlCRFpYSjBhV1pwWTJGMFpUQlpNQk1HQnlxR1NNNDkKQWdFR0NDcUdTTTQ5QXdFSEEwSUFCTnMreWtlS3lIemZhSnJ4U3pFUUdqVEZBYXhqV2ZITWswYmhZUUFTY1lRWgpNRU9xeFd1WXNSRVlMYVA2bGJMMkduWTNVZVJDY1IvRk9XTVRKUE41NGhLamdnRW1NSUlCSWpBT0JnTlZIUThCCkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUdDQ3NHQVFVRkJ3TUJNQXdHQTFVZEV3RUIKL3dRQ01BQXdIUVlEVlIwT0JCWUVGSEMxcm9pY2JLejIzQTRTY2lMOXVLR2xPQ3ptTUI4R0ExVWRJd1FZTUJhQQpGSVV3WFRzcWNOVHQxWkpuQi8zck9iUWFEamluTUVRR0NDc0dBUVVGQndFQkJEZ3dOakEwQmdnckJnRUZCUWN3CkFZWW9hSFIwY0RvdkwyOWpjM0F1WTJ4dmRXUm1iR0Z5WlM1amIyMHZiM0pwWjJsdVgyVmpZMTlqWVRBZkJnTlYKSFJFRUdEQVdnZ29xTGpod05qWTJMbWRoZ2dnNGNEWTJOaTVuWVRBOEJnTlZIUjhFTlRBek1ER2dMNkF0aGl0bwpkSFJ3T2k4dlkzSnNMbU5zYjNWa1pteGhjbVV1WTI5dEwyOXlhV2RwYmw5bFkyTmZZMkV1WTNKc01Bb0dDQ3FHClNNNDlCQU1DQTBrQU1FWUNJUUQrWnV1MUQvOFNqTFVweDdzTFBXZ1d0RkREYVVIR3krN2hkV2k3b3BvVTJ3SWgKQVBVcnNCUmhoQ2JhOFp2VVBDU2pFWnlkWDhYazh3dFcyUHNycWxSMXFycWcKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQotLS0tLUJFR0lOIEFSR08gVFVOTkVMIFRPS0VOLS0tLS0KZXlKNmIyNWxTVVFpT2lJNU1UUmtOemMzTVRnMk1qVm1aall4TVRBd09EQXlaakZtTXprNE5XRTNPQ0lzSW1GagpZMjkxYm5SSlJDSTZJalE0T1RRNE5qTm1aR0U0TkRnMFlqQTVOelJoTkdNME9EWXlOelZsWVdOa0lpd2ljMlZ5CmRtbGpaVXRsZVNJNkluWXhMakF0WVdaaE9ERmtNVGxpT0dZMk9HWTRNak15TXpKa01ETTBMV0k1TlRaaU16azEKWVdWa1pqWTFPVGRrTXpZMFpEbGpNMkU1TVRJd1l6QTNNMkprT0RNNE5qTmlaVFk1TVRJMU9UTXdaV1psTWpkawpPV0kwWmpWak5qZGxaVGhoTXpjMlptRm1PREpoT1RZNE5tTTNaRGc0TWpabFpERmhORFl3T0RBeU5tRTRZakJtCk5Ua3lZMk0xWldGa1pqWXdaRFZqTldWak1qbGxOV0poWkRjeE9UaGlaRGxoWlRJNE1qVmpOVE16TUROaE9ETXcKWmprMk9HTTFNVE1pTENKaGNHbFViMnRsYmlJNklqQjVSRjlrTjBaUVZsUkxRVEkwVEhvdGNITmlXV1ZxYzFsawpaa3QzU2xoUE5sRmZRMVl5Y1RRaWZRPT0KLS0tLS1FTkQgQVJHTyBUVU5ORUwgVE9LRU4tLS0tLQ==
          EOD
          nohup cloudflared tunnel --origincert cert.pem --config config.yaml run > cf.log &
      - name: Connect Server
        run: |
          sleep 5.9h